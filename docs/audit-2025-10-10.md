# Williams Librarian Audit â€“ 2025-10-10

## Current State Snapshot
- Full pytest suite previously verified at 318/318 passing with 100% coverage (htmlcov report dated prior to audit). No tests were re-run during this read-only review.
- Core services (`content_service`, `library_service`, `digest_service`, `maintenance_service`) and repositories (Postgres, Redis, Qdrant, MinIO) are fully implemented and covered by unit/integration tests.
- Deterministic embedding utility (`app/intelligence/embeddings.py`) remains the foundation for semantic features and test determinism.

## Implemented Areas (Stable)
- Business services orchestrate extraction, screening, processing, storage, tier management, statistics, and digest generation.
- Repository layer provides async adapters for Postgres, Redis, Qdrant, and MinIO with thorough happy-path and error-path coverage.
- Domain models (`app/core/models.py`) include rich representations for content, digests, maintenance tasks, and knowledge-graph entities.

## Identified Gaps & Stubs
1. **ETL Pipeline Skeleton**
   - `app/pipeline/` and all subpackages (`extractors`, `transformers`, `loaders`, `knowledge_graph`) contain only empty `__init__.py` files.
   - Documentation (`docs/project-structure.md`) promises concrete modules such as `etl.py`, `web_extractor.py`, and `graph_builder.py`, but none exist.

2. **Streamlit Presentation Layer Missing**
   - `app/presentation/` lacks `app.py`, pages, and reusable components referenced in docs.
   - No UI entry point or Streamlit configuration despite `settings.streamlit_*` flags.

3. **Plugin System Not Implemented**
   - `app/plugins/` is empty; there is no `base.py`, `manager.py`, or `registry.py` to honor `settings.enable_plugins`.
   - `config/prompts/` directory is empty, leaving planned prompt-driven workflows without templates.

4. **Background Workers Absent**
   - `app/workers/` holds only an empty `__init__.py`; scheduled job infrastructure (`digest_worker`, `maintenance_worker`, etc.) is missing.
   - `settings.worker_*` flags have no corresponding implementation.

5. **Knowledge Graph Features Incomplete**
   - Models for `KnowledgeGraphNode` and `Relationship` exist, but no builder, resolver, or repository classes are present.
   - Documentation and tests reference knowledge-graph operations that have not been built.

6. **Utility Scripts & Configuration Artifacts**
   - `scripts/` directory is empty despite documentation listing initialization and maintenance scripts.
   - `config/` lacks the advertised `settings.yaml`, `plugins.yaml`, and prompt templates cited in docs.

7. **Inconsistent MinIO Bucket Naming**
   - `MinIORepository.create_tier_buckets` creates buckets using `prefix-tier-a` naming, while `LibraryService` and other helpers operate on `prefix-a/b/c/d`. The mismatch can orphan buckets or cause uploads to miss intended targets.

8. **Silent Failure in Qdrant Deletes**
   - `QdrantRepository.delete` and `delete_batch` swallow all exceptions with `pass`, suppressing actionable errors during cleanup.

9. **Documentation Mismatch**
   - Several docs (e.g., `project-structure.md`, `implementation-roadmap.md`) describe modules, prompts, and pipelines that do not exist yet, potentially misleading contributors.

## Remediation Plan
| Priority | Workstream | Key Actions | Notes |
|----------|------------|-------------|-------|
| High | Pipeline Implementation | Design and build extractor, transformer, loader, and knowledge-graph modules; provide orchestration entry point (`etl.py`) aligning with documented architecture. | Enables planned ingestion workflows and unlocks knowledge-graph roadmap items. |
| High | Presentation Layer | Implement Streamlit `app.py`, rebuild documented pages/components, and wire to existing services. | Restores end-user access to library features. |
| High | Plugin & Prompt Infrastructure | Create plugin interfaces/manager/registry, populate `config/prompts/` with working templates, and connect feature-flag gating. | Required to honor configurability and extension promises. |
| Medium | Background Workers | Implement worker modules (digest, maintenance, ingestion), integrate with scheduling mechanism, and add targeted tests. | Leverages existing service methods for automation. |
| Medium | Knowledge Graph Execution | Add builder/resolver modules plus persistence strategy so `KnowledgeGraphNode`/`Relationship` models become functional. | Supports planned insights features and aligns with docs. |
| Medium | Scripts & Config Cleanup | Either supply the documented scripts/config files or update documentation to reflect the leaner footprint. | Prevents onboarding confusion. |
| Medium | MinIO Naming Bug | Harmonize bucket naming (either use `prefix-tier-x` everywhere or move fully to `prefix-x`) and add regression tests around tier movement. | Avoids storage inconsistencies. |
| Low | Qdrant Delete Error Handling | Replace blanket `pass` with logging or selective suppression to surface real errors while tolerating "not found" cases. | Improves observability without breaking tests. |
| Low | Documentation Audit | Update architectural docs and roadmap once implementations land to keep expectations accurate. | Keeps contributors aligned. |

## Suggested Next Steps
1. Socialize this report with maintainers to confirm priority order.
2. Spin up dedicated feature branches per high-priority workstream.
3. Establish acceptance tests for newly implemented modules (UI smoke tests, pipeline integration tests, worker scheduling tests).
4. Re-run full pytest suite and refresh coverage once new components are delivered.
